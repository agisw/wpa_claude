import { Meta } from '@storybook/addon-docs/blocks'

<Meta title="Contributing/Dev Guide/Commit Strategy" />

# 커밋 전략

## 작동 방식

- 변경 사항 스테이징: `git add .`
- 커밋: `pnpm run commit`
  - 커밋하는 변경 사항의 **유형** 선택
  - 이 변경 사항의 **범위** 선택 [선택 사항]
  - 변경 사항에 대한 짧고 명령형 시제의 설명 작성
  - 변경 사항에 대한 자세한 설명 제공 [선택 사항]
  - **호환되지 않는 변경 사항**이 있는지 여부 선택 (y/N)
  - 이 변경 사항이 열려 있는 이슈에 영향을 미치는지 여부 선택 (y/N)

## 커밋 컨벤션

**DSDS**는 [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0)라는 커밋 컨벤션을 따릅니다.

의존성의 새로운 패치 버전으로 업그레이드한 후 애플리케이션이 500 오류를 연속적으로 발생시키기 시작하는 경험을 해본 사람이라면, 이후의 포렌식 과정에서 읽기 쉬운 커밋 내역(및 이상적으로 잘 유지 관리되는 CHANGELOG)이 얼마나 중요한지 알 수 있습니다.
Conventional Commits 사양은 커밋 메시지에 표준화된 경량 컨벤션을 도입할 것을 제안합니다. 이 컨벤션은 [SemVer](https://semver.org/)와 연계되어 소프트웨어 개발자가 커밋 메시지에서 자신이 수행한 기능, 수정 및 호환되지 않는 변경 사항을 설명하도록 합니다.
이 컨벤션을 도입함으로써, 프로젝트 경계 전반에 걸쳐 문제를 디버깅하기 쉽게 만드는 공통 언어를 만듭니다.

커밋 메시지는 다음과 같은 구조를 따라야 합니다.

```
<유형>[선택적 범위]: <설명>

[선택적 본문]

[선택적 꼬리말]
```


일반적으로 패턴은 다음과 같습니다.

`유형(범위?): 제목  #범위는 선택 사항이며 여러 범위가 지원됩니다 (현재 구분 기호 옵션: "/", "\" 및 ",")`

더 자세한 정보는 [사양 문서](https://www.conventionalcommits.org/en/v1.0.0/#specification)를 참조하세요.

## 컨벤션 강제

컨벤션을 강제하기 위해 [commitlint](https://github.com/conventional-changelog/commitlint)가 [@commitlint/config-conventional](https://github.com/conventional-changelog/commitlint/tree/master/%40commitlint/config-conventional)을 사용하여 커밋 메시지가 Conventional Commit 형식과 일치하는지 확인합니다.

## 릴리즈 & 태깅 전략

@dsds/vue-vuetify 패키지는 **main 브랜치에 태그만 추가**하는 방식으로 릴리즈를 고정합니다. 태그 이름은 `@dsds/vue-vuetify@<version>` 패턴을 사용하며, 사전 배포판(예: `0.2.0-beta`)도 [Semantic Versioning](https://semver.org/) 규칙을 그대로 따릅니다.

릴리즈 절차는 다음 단계를 권장합니다.

1. 문서 및 코드 업데이트
  - `CHANGELOG.md`, `releases/RELEASE_v<version>.md`, Storybook 문서를 최신화합니다.
  - 필요한 경우 README, GettingStarted 등 사용자-facing 콘텐츠를 검토합니다.
2. 커밋 및 검증
  - 모든 변경 사항을 Conventional Commit 메시지로 커밋합니다.
  - 테스트/빌드를 수행하고 CI가 통과했는지 확인합니다.
3. 태깅 및 푸시
  - `scripts/release.sh`를 실행하여 태그를 생성하고 원격 저장소로 푸시합니다.
4. GitHub Release 작성
  - `releases/` 디렉터리의 해당 버전 파일을 복사해 GitHub Release 본문으로 사용합니다.

### release.sh 사용법

`scripts/release.sh`는 깔끔한 워킹트리를 전제로 동작합니다.

```bash
./scripts/release.sh 0.2.0-beta
```

- 첫 번째 인자로 버전 문자열을 입력합니다.
- 스크립트는 `@dsds/vue-vuetify@<version>` 태그를 생성하고 `origin`으로 푸시합니다.
- 인자를 전달하지 않으면 사용 방법을 출력하고 종료합니다.
- 태그가 이미 존재하거나 워킹트리에 변경 사항이 있으면 실패합니다.

## Lerna 통합

TODO: Lerna 패키지 및 작업 공간 이름을 범위로 자동으로 감지하고 적용하기 위해 [@commitlint/config-lerna-scopes](https://github.com/conventional-changelog/commitlint/tree/master/@commitlint/config-lerna-scopes)를 사용합니다.

## 추가 자료

- [Conventional Commits를 사용하는 이유?](https://www.conventionalcommits.org/en/v1.0.0/#why-use-conventional-commits)
- ["컨벤션에 따른 커밋의 장점" (발표 자료)](https://slides.com/marionebl/the-perks-of-committing-with-conventions)