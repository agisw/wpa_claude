import { Canvas, Meta } from '@storybook/addon-docs/blocks'

import * as FormStories from './Form.stories'
import * as PageStories from './Page.stories'
import * as PageFilterStories from './PageFilter.stories'

<Meta title="Layouts/Overview" />

# DSDS를 이용한 레이아웃 설계 및 구현 개요

이 문서는 `Page`, `PageFilter` 그리고 `Form` 계열 컴포넌트를 조합해 화면 레이아웃을 설계하는 방법을 정리한 가이드입니다.

다양한 UI에서 실제 사용 중인 패턴을 기반으로 실전 화면을 설계할 때 재사용할 수 있는 기본 뼈대를 제공합니다.

## 핵심 원칙

DSDS 레이아웃 시스템의 가장 중요한 원칙은 **"레이아웃의 구조와 스타일을 컴포넌트에게 위임하는 것"** 입니다.

- **레이아웃 컴포넌트 우선**: `div` 태그와 Tailwind 유틸리티 클래스(`flex`, `gap-2` 등)를 직접 조합하여 레이아웃을 잡는 것을 **지양**합니다. 가능한 최대한 `PageHeader`, `PageBody`, `PagePanel`, `PageFilter` 등 전용 레이아웃 컴포넌트를 사용하세요.
- **관심사 위임**: 간격, 폰트, 구분선, 정렬 등의 스타일링 처리는 컴포넌트 내부에서 자동으로 처리됩니다. 개발자는 **구조적 배치에만 집중** 하면 됩니다.
- **일관성 유지**: 레이아웃 전용 컴포넌트를 사용하면 애플리케이션 전체에서 일관된 여백과 배치를 보장받을 수 있으며, 디자인 시스템 변경 시 일괄 적용이 용이합니다.
- **명시적 슬롯 활용**: 각 컴포넌트가 제공하는 명시적 슬롯(`tools`, `filter`, `title-tools` 등)을 사용하여 UI 요소를 배치합니다. 이는 코드의 가독성을 높이고 의도를 명확히 합니다.

> **⚠️ 예제코드의 레거시 패턴 주의**
>
> 기존 코드베이스나 일부 예제(`EESAlarmSummaryChart.vue`, `CleanLotDashboardHeaderFilterBody.vue` 등)에서는  `div` 태그에 `flex`, `items-center` 등을 직접 적용하여 버튼 그룹을 구현한 경우가 있습니다.
>
> 레이아웃 시스템이 갖춰지기 전 작성된 과도기적 코드로, 새로운 화면을 설계할 때는 이러한 패턴을 지양해야 합니다.
>
> **권장하지 않는 패턴 (Legacy):**
> ```html
> <!-- 지양해야 할 패턴: 직접 스타일링 -->
> <div class="flex items-center gap-1">
>   <VBtn>...</VBtn>
>   <VBtn>...</VBtn>
> </div>
> ```
>
> **권장 패턴 (Recommended):**
> ```html
> <!-- 권장 패턴: 전용 컴포넌트 사용 -->
> <PageFilterToolGroup>
>   <VBtn>...</VBtn>
>   <VBtn>...</VBtn>
> </PageFilterToolGroup>
> ```


## 구성 요소

![layout-anatomy](/static/images/dsds/layout-anatomy.png)
![pagefilter-anatomy](/static/images/dsds/pagefilter-anatomy.png)

| 그룹 | 그룹2 | 컴포넌트 | 용도 | 주요 Props / 슬롯 |
| --- | --- | --- | --- | --- |
| Form | | `FormLabel` | 섹션/필드 제목 레이블 | `required`, 임의 속성 전달 |
|  | |`FormField` | 라벨과 입력 요소를 감싸는 폼 래퍼 | `label`, `required`, `size`, `tools` 슬롯 |
|  | |`FormTools` | 폼 액션/툴 버튼 정렬 컨테이너 | 임의 슬롯 컨텐츠 |
| Page | Header | `PageHeader` | 페이지 상단 제목 및 주요 액션 영역 | `title`, `showFavorite`, `#tools`, `#filter` 슬롯 |
| | | `PageHeaderFilter` | `PageHeader`의 `#filter` 슬롯 안에 배치되는 검색/필터 래퍼 | `collapsed`, `collapse-button-position`, `v-model:collapsed` |
| | | `PageHeaderFilterRow` | 필터 영역 레이아웃 래퍼 | 기본 슬롯에 폼 배치 |
| | Body | `PageBody` | 콘텐츠 본문 컨테이너 | 사용자 정의 클래스, `PageBodyTools` 조합 |
| | | `PageBodyTools` | 본문 상단 보조 툴바 | 기본 슬롯, 유틸리티 버튼 정렬 |
| | Panel| `PagePanel` | 데이터/분석용 패널 래퍼 | 기본 슬롯, `class` |
| | | `PagePanelHeader` | 패널 상단 헤더 | `title-tools`, `tools` 슬롯 |
| | | `PagePanelTools` | 패널 전용 보조 툴바 | 기본 슬롯 |
| | PageFilter | `PageFilter` | 사이드/콘텐츠 패널 기본 컨테이너 | 기본 슬롯 |
| | | `PageFilterSection` | 패널 내부 구획을 나누는 컨테이너 | 기본 슬롯, `class` |
| | | `PageFilterSectionFooter` | 패널 하단 액션 고정 영역 | 기본 슬롯 |
| | | `PageFilterDivider` | 패널 구획 구분선 | `doubleLine` |
| | |`PageFilterToolGroup` | 패널 상단/하단 툴 정렬 | 기본 슬롯 |
| Splitter | | `Splitter` | 좌/우 혹은 상/하 영역 분할 | `direction`, `gutterSize` |
| | | `SplitterPanel` | Splitter 하위 영역 | `defaultSize`, `defaultWidth`, `minWidth`, `maxWidth` |
| | | `SplitterHandle` | 패널 사이 드래그 핸들 | - |

> **TIP:** `FakeRealGrid`와 같은 faker 컴포넌트를 활용해 레이아웃을 검증하면 실 데이터 없이도 스크롤, 툴바, 패널 높이를 빠르게 점검할 수 있습니다.


### 레이아웃 계층 구조 <layoutHierarchy />

아래 트리는 `BasicLayout.vue`와 예제 스토리를 기준으로 레이아웃 빌딩 블록이 배치될 수 있는 일반적인 구조를 정리한 것입니다.

```
LayoutRoot (dsds-basic-layout)
├─ Header
├─ LayoutBody
│  ├─ LNB (선택)
│  └─ Page
│     ├─ PageHeader
│     │  ├─ template #tools → Breadcrumb | PageFilterToolGroup | FormTools 등
│     │  └─ template #filter (선택)
│     │     └─ PageHeaderFilter (선택)
│     │        └─ PageHeaderFilterRow
│     │           ├─ FormField
│     │           │  ├─ FormLabel (자동 포함)
│     │           │  └─ 입력 컴포넌트 (VSelect, VTextField 등)
│     │           └─ FormTools (검색/초기화 버튼 등)
│     ├─ PageBody
│     │  ├─ PageBodyTools (선택)
│     │  └─ 내부 콘텐츠
│     │     ├─ Splitter (선택)
│     │     │  ├─ SplitterPanel → PagePanel | PageFilter | 일반 콘텐츠
│     │     │  └─ SplitterHandle
│     │     ├─ PagePanel (선택)
│     │     │  ├─ PagePanelHeader
│     │     │  │  ├─ title-tools 슬롯
│     │     │  │  └─ tools 슬롯
│     │     │  ├─ PagePanelTools (선택)
│     │     │  └─ 내부 콘텐츠 → PageFilter | Chart | Grid
│     │     │     └─ PageFilter (선택)
│     │     │        ├─ PageFilterSection (중첩 가능)
│     │     │        │  └─ FormField/FormLabel + 입력 컴포넌트
│     │     │        ├─ PageFilterDivider (구획 분리)
│     │     │        ├─ PageFilterSectionFooter (액션 고정)
│     │     │        └─ PageFilterToolGroup (툴 정렬)
│     │     └─ 일반 콘텐츠 (FakeRealGrid, Chart, PageFilter 등)
│     ├─ PageTabs (선택)
│     └─ Footer (선택)
```

## Page 패턴

### PageHeader

`PageHeader`는 페이지의 제목과 전역 액션, 그리고 필터 영역을 정의합니다.

- **#tools 슬롯**: Breadcrumb, 주요 버튼, `v-divider`를 한 줄에 배치해 글로벌 액션을 모으는 용도로 사용합니다.
- **#filter 슬롯**: 검색 조건이나 필터 폼이 필요할 때 사용합니다. `PageHeaderFilter`로 감싸 접힘/펼침 기능을 제공하거나, `PageHeaderFilterRow`를 직접 배치할 수 있습니다.

```html
<!-- PageHeader #tools 및 #filter 슬롯 활용 예시 -->
<PageHeader title="페이지 제목">
  <template #tools>
    <v-btn variant="primary">주요 액션</v-btn>
    <v-divider vertical />
    <Breadcrumb :items="items" />
  </template>
  <template #filter>
    <PageHeaderFilter>
      <PageHeaderFilterRow>
        <FormField ... />
      </PageHeaderFilterRow>
    </PageHeaderFilter>
  </template>
</PageHeader>
```

### PageBody

`PageBody`는 페이지의 메인 콘텐츠가 위치하는 영역으로, 남은 세로 공간을 모두 차지(`flex-1`)하며 내부 스크롤을 관리합니다.

- **PageBodyTools**: 본문 상단에 위치하여 검색 결과 수, 정렬 옵션, 보기 방식 선택 등 콘텐츠와 밀접한 도구를 배치합니다.
- **내부 콘텐츠**: Grid, Chart, 혹은 `Splitter`를 배치합니다.

#### PagePanel

`PagePanel`은 `PageBody` 내부에서 화면을 구획할 때 사용하는 컨테이너입니다. 주로 `Splitter`와 함께 사용되어 좌/우 혹은 상/하로 나뉜 영역 각각을 독립적인 패널로 감쌉니다.

- **독립적 헤더**: `PagePanelHeader`를 통해 패널만의 제목과 도구(`title-tools`, `tools`)를 가집니다.
- **구조적 역할**: `Page`가 전체 화면의 뼈대라면, `PagePanel`은 그 안의 세부 콘텐츠 블록을 정의합니다.

#### PageFilter

`PageFilter`는 `PagePanel` 내부나 `Splitter`의 한쪽 패널에서 복잡한 필터링/선택 UI를 구성할 때 사용하는 컴포넌트입니다. `PageFilterSection`, `PageFilterDivider` 등과 조합해 밀도 높은 폼 레이아웃을 만듭니다. 자세한 내용은 [PageFilter 패턴](#pagefilter-패턴) 섹션을 참고하세요.

### 1. 기본 페이지 뼈대 <pageBasicStructure />

간단한 헤더 + 본문 구조로, 온보딩/문서 페이지처럼 정적인 내용을 배치하기에 적합합니다.

<Canvas of={PageStories.BasicStructure} />

**구현 요령**

- 외부 컨테이너에 `h-screen` 과 `flex` 레이아웃을 지정해 높이를 확보합니다.
- `PageBody`는 기본 패딩을 제공하므로 카드, 설명 텍스트 등을 배치하기 쉽습니다.
- `tools` 슬롯을 사용해 우측에 브레드크럼, CTA 버튼을 배치합니다.

### 2. 헤더 필터 + 본문 탭형 대시보드 <pageFilterDashboard />

검색 폼과 데이터 리스트가 한 화면에 필요한 경우 사용합니다. `Examples/PEMS` 대시보드 예제에서 사용한 패턴입니다.

<Canvas of={PageStories.FilterableDashboard} />

**핵심 포인트**

- `PageHeader`의 `#filter` 슬롯에 `PageHeaderFilter` + `PageHeaderFilterRow`를 배치해 Grid 형태의 필터를 구성하면 반응형 대응이 쉽습니다.
- `PageBodyTools`는 결과 건수, 페이지당 개수 선택, 정렬 옵션 등을 노출하는데 적합합니다.
- 본문 구성 요소(FakeRealGrid, Pagination 등)는 `PageBody` 안에서만 스크롤되도록 구성합니다.

### 3. 분할 뷰 워크스페이스 <pageSplitWorkspace />

좌측 탐색 + 우측 분석 화면처럼 복잡한 워크스페이스에 사용합니다. `Examples/EES-UI`에서 Splitter 및 PagePanel 조합을 참고했습니다.

<Canvas of={PageStories.SplitWorkspace} />

**핵심 포인트**

- `Splitter`를 중첩해 좌우/상하 2중 분할을 구현합니다.
- 상단 패널은 `PagePanelHeader` + 데이터 테이블, 하단은 분석/차트 영역으로 나누어 정보 밀도를 높입니다.
- `PageFilterToolGroup`을 활용해 차트 필터, 액션 버튼을 정렬합니다.

## PageFilter 패턴

`PageFilter` 계열 컴포넌트는 `PagePanel` 내부나 사이드바 영역에서 밀도 높은 폼과 도구를 정돈하기 위해 설계되었습니다.

### 주요 컴포넌트 역할

- **PageFilter**: 필터 영역의 최상위 컨테이너입니다. `flex` 레이아웃을 기반으로 내부 섹션을 수직으로 쌓습니다.
- **PageFilterSection**: 필터 내의 논리적 구획을 나눕니다. `grid` 클래스와 함께 사용하여 내부 `FormField`를 2열/3열로 배치하거나, `flex-1`을 주어 남은 공간을 채우는 그리드/리스트 영역으로 활용합니다.
- **PageFilterDivider**: 섹션 간의 구분선을 그립니다. `doubleLine` 속성으로 더 강한 구분을 줄 수 있습니다.
- **PageFilterToolGroup**: 버튼이나 선택 도구(`VSelect`, `ToggleButton` 등)를 그룹핑하여 `PagePanelHeader`나 `PageFilterSection` 내에서 일관된 간격으로 배치합니다.
- **PageFilterSectionFooter**: 섹션 하단에 고정되는 액션 영역(검색, 초기화, 저장 등)을 정의합니다.

### 1. 스크롤 가능한 필터 패널 <pageFilterSidePanel />

`Examples/EES-UI`의 사이드 패널에서 추출한 패턴입니다. 북마크 로딩, 필드 그룹, 탭 기반 기간 선택을 한 컨테이너에 모읍니다.

<Canvas of={PageFilterStories.SidePageFilter} />

**구현 요령**

- 상단에 액션 버튼을 배치하고, `ScrollArea`로 나머지를 감싸 스크롤 높이를 제어합니다.
- `PageFilterSectionFooter`는 검색/초기화 버튼과 히스토리 액션을 고정하는 데 유용합니다.
- `VTabs` + `VTabsWindow`로 기간 선택 UI를 토글합니다.

### 2. 데이터 선택 패널 <pageFilterSelection />

목록 또는 테이블과 함께 동작하는 선택 패널입니다. `FakeRealGrid`를 넣어 결과를 표시하고 하단 푸터에서 최종 액션을 제공합니다.

<Canvas of={PageFilterStories.SelectionPageFilter} />

**핵심 포인트**

- `PageFilterToolGroup`으로 상단 툴을 오른쪽 정렬하면 일관성을 유지할 수 있습니다.
- `PageFilterDivider`의 `doubleLine` 옵션은 그룹 간 시각적 구분을 제공합니다.
- 하단 액션 버튼을 `PageFilterSectionFooter`에 배치하면 스크롤과 무관하게 액션이 고정됩니다.

### 3. PageFilter + PagePanel 조합 <pageFilterWorkspaceCombo />

분석/차트 UI처럼 패널이 페이지 본문에 포함될 때의 패턴입니다.

<Canvas of={PageFilterStories.PageHeaderPanelFilterToolGroup} />

**구현 요령**

- `title-tools` 슬롯에는 현재 컨텍스트(차트 타입 등)를 정의하는 선택 UI를, `tools` 슬롯에는 전역 액션(Export 등)을 배치합니다.
- `PagePanelTools`를 사용해 패널 내부의 보조 액션을 구분합니다.
- 패널 내부 콘텐츠는 `flex-1` 로 지정해 데이터/차트 영역이 패널을 채우도록 합니다.


## Form 패턴

### 1. 2열 검색 폼 <formTwoColumn />

`<PageFilterSection>` 을 `grid grid-cols-2` 레이아웃으로 지정 후  `FormField`와 `FormTools`를 조합해 빠르게 폼 레이아웃을 구성할 수 있습니다.

```tsx
  <PageFilter>
    <PageFilterSection class="grid grid-cols-2" >
      <FormField label="필드 1">...</FormField>
      <FormField label="필드 2">...</FormField>
    </PageFilterSection>
  </PageFilter>
```

<Canvas of={FormStories.SimpleGrid} />

**구현 요령**

- `PageHeader`의 `#filter` 슬롯 안에서 `PageHeaderFilter` + `PageHeaderFilterRow` 조합으로 2열 그리드를 구성하면 행별 정렬이 수월합니다.
- `FormTools`를 사용해 검색/초기화 버튼을 우측 정렬하고, 유틸리티 액션을 한 위치에 모읍니다.
- 선택 필드(`VSelect`)는 `clearable` 옵션으로 재설정 UX를 개선하세요.

### 2. 툴 슬롯을 활용한 기간 입력 <formToolsPeriod />

`FormField`의 `tools` 슬롯을 사용하면 기간 선택 방식 전환과 같은 컨텍스트 액션을 한 줄에 배치할 수 있습니다.

<Canvas of={FormStories.FieldToolsSlot} />

**핵심 포인트**

- `VTabs`로 입력 방식을 전환하고, 내부에는 `VueDatePicker` 또는 `VSelect` 조합을 토글합니다.
- 슬롯 내부에 배치한 UI는 레이블 오른쪽에 자동으로 정렬되어 시각적 균형을 유지합니다.

### 3. 독립 레이블 + 액션 도구 모음 <formStandaloneLabelTools />

폼 섹션 헤더에서 레이블과 액션 버튼을 수평 배치하는 패턴입니다. 다이얼로그나 패널에서 세부 조건을 저장/로드할 때 활용하세요.

<Canvas of={FormStories.FormFieldAttachedTools} />

**구현 요령**

- `FormLabel`을 단독으로 사용하면 블록 레벨 제목으로 재사용할 수 있습니다.
- `FormTools`는 단순한 `div` 컴포넌트로, 버튼 외에도 필터/토글 등을 자유롭게 배치할 수 있습니다.
- 레이블이 필수 항목일 경우 `required` prop으로 별도 스타일(별표)을 노출합니다.

## 설계 체크리스트

1. **높이와 스크롤**: 페이지 루트에 `h-screen` 을 적용했는지, 스크롤이 중첩되지 않는지 확인합니다. `v-app` 레이아웃을 사용하는 경우 `v-main` 영역의 스크롤 정책을 확인하세요.
2. **툴 정렬**: 반복되는 액션 버튼은 `PageFilterToolGroup`, `PageBodyTools` 등 전용 래퍼를 사용합니다.
3. **데이터 그리드**: `grid-template-columns`가 필요한 경우(`ScrollableTable` 등) 클래스 이름을 명시하고 문서화합니다.
4. **분할 레이아웃**: `SplitterPanel`의 `minWidth`, `maxWidth`, `defaultWidth`를 지정해 극단적인 리사이즈를 방지합니다.
5. **상태 관리**: 즐겨찾기, 탭, 검색 조건과 같이 헤더와 본문이 공유하는 상태는 `ref` + `computed` 조합으로 상위에서 관리합니다.

## 추가 리소스

- `src/stories/examples/ees-ui` — 알람 요약 페이지, 사이드 패널, 스플리터 패턴
- `src/stories/examples/pems` — 필터 + 데이터 리스트 대시보드, 다이얼로그 예제
- `src/stories/layouts/Page.stories.ts` / `PageFilter.stories.ts` — 이 문서에서 참조한 스토리 소스 코드

> **다음 단계**: 신규 화면을 설계할 때는 위 스토리를 복제한 후 도메인 컴포넌트로 교체하면서 스타일과 데이터 행동을 검증하세요.
